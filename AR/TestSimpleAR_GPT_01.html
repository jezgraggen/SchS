<!doctype HTML>
<html>
    <!-- Einbindung von Simple-AR (ohne AR.js) -->
    <script src="https://cdn.jsdelivr.net/npm/simple-ar@latest"></script>

    <!-- Dynamisches Erzeugen von Markern und Dateiladen -->
    <script>
        // Anzahl der Marker, die dynamisch erzeugt werden sollen
        const numMarkers = 300; // Du kannst diese Zahl anpassen

        // Funktion, um Marker dynamisch zu erzeugen
        function createMarkers() {
            const scene = document.getElementById('scene'); // Szene, in die die Marker eingefügt werden
            for (let i = 0; i < numMarkers; i++) {
                // Erzeuge ein neues Marker-Element
                const marker = document.createElement('simple-marker');
                marker.setAttribute('id', `marker-${i}`); // Einzigartige ID für jeden Marker
                marker.setAttribute('marker-id', i); // Weist jedem Marker eine ID zu
                marker.setAttribute('dynamic-file-loader', `value: ${i}`); // Wendet die dynamische Datei-Lade-Komponente an
                scene.appendChild(marker); // Füge den Marker zur Szene hinzu
            }
        }

        // Sobald die Seite geladen ist, rufe die Funktion auf
        window.onload = function () {
            createMarkers();
        };

        // Dynamisches Laden von 3D-Modellen, Bildern und Videos
        function loadContent(markerId) {
            var possibleFiles = [
                `/SchS/AR/modelle/${("000" + markerId).slice(-3)}.glb`,
                `/SchS/AR/modelle/${("000" + markerId).slice(-3)}.obj`,
                `/SchS/AR/images/${("000" + markerId).slice(-3)}.jpg`,
                `/SchS/AR/images/${("000" + markerId).slice(-3)}.png`,
                `/SchS/AR/videos/${("000" + markerId).slice(-3)}.mp4`
            ];

            var marker = document.getElementById(`marker-${markerId}`);

            // Dynamisch die Datei basierend auf dem Marker-Wert laden
            possibleFiles.forEach(function (fileUrl) {
                fileExists(fileUrl, function (exists) {
                    if (exists) {
                        if (fileUrl.endsWith('.glb') || fileUrl.endsWith('.obj')) {
                            // 3D-Modell laden
                            marker.innerHTML = `
                                <simple-model src="${fileUrl}" scale="0.1 0.1 0.1"></simple-model>
                            `;
                        } else if (fileUrl.endsWith('.jpg') || fileUrl.endsWith('.png')) {
                            // Bild laden
                            marker.innerHTML = `
                                <simple-image src="${fileUrl}"></simple-image>
                            `;
                        } else if (fileUrl.endsWith('.mp4')) {
                            // Video laden
                            marker.innerHTML = `
                                <simple-video src="${fileUrl}" autoplay loop></simple-video>
                            `;
                        }
                        return; // Sobald eine gültige Datei gefunden wurde, nicht weiter suchen
                    }
                });
            });
        }

        // Funktion zum Überprüfen, ob eine Datei existiert
        function fileExists(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('HEAD', url, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    callback(xhr.status !== 404); // Datei existiert, wenn kein 404 Fehler
                }
            };
            xhr.send();
        }
    </script>

    <body>
        <!-- Dynamische AR-Szene -->
        <simple-scene id="scene">
            <!-- Dynamisch erzeugte Marker werden hier hinzugefügt -->
        </simple-scene>
    </body>
</html>
